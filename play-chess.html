<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="newgame.css">
    <link rel="stylesheet" href="gameover.css">

</head>
<style>


    .inner-text {
        margin-top: -1px;
        width: 90%;
    }

    .bg-image {
        background-image:url("bg.png");
        background-size: cover;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        position: fixed;
        min-height: 100%;
        min-width: 100%;
        animation: blur 3s ease-in-out;
        z-index: -99999;
        filter: blur(10px);
     
    }

    .text-outline {
        text-shadow: 
            -2px -2px 0 black,  
             2px -2px 0 black,
            -2px  2px 0 black,
             2px  2px 0 black; /* Outline color */

    }

    .header {

        background-color: darkgreen;
        border-radius: 10px;
        border: solid black;
        z-index: 1;
        display: flex;
        justify-content:center;
        align-content: center;
        color: white;
        letter-spacing: 5px;
        font-family: Broadway;
        overflow: hidden;
        font-size: 80%;
        height: 10%;
        animation: desc 2s ease-out;
    }

    @keyframes desc {
        0% {
            transform: translateY(-100%);
        }

        100% {
            transform: translateY(0%);
        }
    }

    .option-box {
        display: flex;
        min-height: 200px;
        align-items: center;
        flex-direction: column;
        border: solid 3px black;
        border-radius: 20px;
        width: 25vw;
        min-height: 100%;
        
        color: yellow;
        text-align: center;
        font-family: Arial, Helvetica, sans-serif;
        cursor: pointer;

    }

    .inner-text {
        font-size:2vw;
    }
    .inner-image {
        max-width: 80%; max-height: 100%; object-fit: contain; overflow: hidden;
        margin-bottom: 10px;
    }

    @keyframes blur {
        0% {
            filter: blur(0px);
        }
        100% {
            filter: blur(10px);
        }
    }

    #box-container {
        display: flex; align-content: center; justify-content: center; flex-direction: row; width: 100%; justify-content: space-around; padding-top: 8%;
        overflow: hidden;
    }

    .invalid-input {
        color: rgb(166, 12, 12);
        display: none;
    }

    .exit-button {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 1;
        width: 15%;
        height: 15%;
        background: none;
        border: none;
        cursor: pointer;
    }








</style>
<body>
    <div class=bg-image></div>


    <div class="header"><h1 class="text-outline">Play Chess</h1></div>
    
    <div id="box-container">
        
        <div id="robot" class="option-box" style="background-color: rgb(18, 8, 127);">
            <h2 style="font-size: larger;"><u>Play A Robot</u></h2>
            <p class="inner-text">Play against the stockfish chess engine.</p>
            <img class="inner-image" src="stockfish.jpg">      
        </div>

        <div id="online" class="option-box" style="background-color: rgb(127, 8, 127);">
            <h2 style="font-size: larger;"><u>Play Online</u></h2>
            <p class="inner-text">Play against a friend  as the host. Provides settings for creating a game.</p>
            <img class="inner-image" src="online.png">      
        </div>

        <div id="challenge" class="option-box" style="background-color: rgb(127, 8, 8);">
            <h2 style="font-size: larger;"><u>Join A Game</u></h2>
            <p class="inner-text">Join an online chess game through a challenge link.</p>
            <img class="inner-image" src="padlock.png">     
        </div>
   

    </div>

   
    <script>
         function hideJoinGame() {
            let joinGame=document.getElementById("join-game-container");
            joinGame.style.display="none";
        }
    </script>


    <div id="join-game-container" style="display: none;" class="newGame">

            <form id="join-game" method="post" style="display: flex; flex-direction: column; align-items: center; gap: 5px; background-color: grey; padding: 5px; border: solid black; color: white; font-family: Arial, Helvetica, sans-serif; height: fit-content; position: relative; align-self: center;">
                <button class="exit-button" onclick="hideJoinGame()"><img src="exit-button.png" style="width: 100%; height: auto;"></button>
                <div></div>
                <h2>Join Game</h2>
                <label>Enter Game ID</label>
                
                <input type="text" name="id">
                <label>Enter Username</label>
                <input type="text" name="username">
                <label id="error-text" class="invalid-input"></label>
                <input class="submit-button" type="submit" value="Join Game">

            </form>
    </div>


  

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

<div id="new-game-container" class="newGame" style="display: none;">
    <div class="gameOverBox newGameBox">
        <p class="gameOverText">New Game</p>
        <label class="lower-text">Enter Username:</label>
        <input type="text" name="username-input" id="online-username-input" style="margin-top: 10px;">
        <p class="lower-text">I play as:</p>
        <form class="lower-text" style="display: flex; gap:10px; background:linear-gradient(to right, black 50%, white 50%); padding-inline: 10px; padding-top: 2px; padding-bottom: 3px; border: solid 1px black; border-radius: 4px;">
            <span style="display:flex;">
                <input id="blackSelector" class="plr-color-selector" type="radio" value="black" name="plrColor">
                <label for="blackSelector">Black</label>
            </span>
            <span style="display:flex;">
                <input checked="true" id="whiteSelector" class="plr-color-selector" type="radio" name="plrColor" value="white">
                <label style="color: black;" for="whiteSelector">White</label>
            </span>
        </form>
        <button id="play-game" class="lower-text" style="object-fit: contain; margin-bottom: 20px;">Play Game</button>
    </div>
</div>

<script type="module">
    import * as Misc from "./misc.js";


    document.getElementById("play-game").addEventListener("click",() => {
        let usernameInput=document.getElementById("online-username-input");
        let plrColor=(document.getElementById("blackSelector")).checked;
        (usernameInput.style.display=="none") ? Misc.action("/join-game.php",{"play-computer":true}) : Misc.action("/join-game.php",{"username":usernameInput.value,"playercolor":plrColor});
    })
</script>


<script type="module">

    let elems=document.getElementsByClassName("option-box");
    let joinGame=document.getElementById("join-game-container");
    let newGame=document.getElementById("new-game-container");
    let usernameInput=document.getElementById("online-username-input");
    for (let elem of elems) {

        switch (elem.id) {
            case "challenge": 
                elem.onclick=() => {
                    joinGame.style.display="flex";
                }
                break;

            case "online":
                elem.onclick=() => {
                    newGame.style.display="";
                    usernameInput.style.display="inline";
                }
                break;


            case "robot":
            elem.onclick=() => {
                    newGame.style.display="";
                    usernameInput.style.display="none";
                }
                break;

            }
    }
    import * as Multiplayer from "./mp_requests.js";
    document.getElementById("join-game").addEventListener("submit",async (event) => {
        event.preventDefault();
        let data=new FormData(event.target);
        let id=data.get("id");
        let username=data.get("username");
        let res=await Multiplayer.mp_checkIfCanJoinGame(id,username);
        if (res.Error) {
            let text=document.getElementById("error-text");
            text.innerText="*"+res.Error;
            text.style.display="inline";
        }

        else {
            let hiddenForm=document.createElement("form");
            hiddenForm.action="/join-game.php";
            hiddenForm.method="POST";
            hiddenForm.style.display="none";
            document.body.appendChild(hiddenForm);

            let form_username=document.createElement("input");
            form_username.type="text";
            form_username.name="username";
            form_username.value=username;
            hiddenForm.appendChild(form_username);

            let form_id=document.createElement("input");
            form_id.type="text";
            form_id.name="id";
            form_id.value=id;
            hiddenForm.appendChild(form_id);
            hiddenForm.submit();
            hiddenForm.remove();

        }
        
    });
</script>

</body>